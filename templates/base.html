{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}Bal Carpet{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&display=swap" rel="stylesheet" />
  <style>
    :root{
      --page-bg: url("{% static 'img/background.jpg' %}");
      /* —Å—Ç–∞–ª–æ —á—É—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω–µ–µ, —á—Ç–æ–± —Ñ–æ–Ω ¬´–ø—Ä–æ—Å–≤–µ—á–∏–≤–∞–ª¬ª —Å–∏–ª—å–Ω–µ–µ */
      --glass-bg: rgba(255,255,255,0.45); /* –±—ã–ª–æ 0.60 */
      --glass-blur: 8px;                 /* –±—ã–ª–æ 10px */
      --veil-top:  0.22;                 /* –≤–µ—Ä—Ö–Ω—è—è –≤—É–∞–ª—å */
      --veil-bot:  0.32;                 /* –Ω–∏–∂–Ω—è—è –≤—É–∞–ª—å */
      --vignette:  rgba(0,0,0,.06);      /* –º—è–≥–∫–∞—è –≤–∏–Ω—å–µ—Ç–∫–∞ –ø–æ –∫—Ä–∞—è–º */
    }

    html, body { background: transparent; }
    body{
      font-family: 'DM Serif Display', serif;
      min-height: 100vh;
      background-image: var(--page-bg);
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    /* –§–æ–Ω —Å—Ç–∞–ª –∑–∞–º–µ—Ç–Ω–µ–µ: –º–µ–Ω—å—à–µ blur + –ª—ë–≥–∫–∞—è –≤–∏–Ω—å–µ—Ç–∫–∞ */
    body.ambient-bg{ position: relative; z-index: 0; }
    body.ambient-bg::before{
      content:"";
      position:fixed; inset:0;
      background-image: var(--page-bg);
      background-size: cover;
      background-position: center;
      filter: blur(12px) saturate(118%);   /* –±—ã–ª–æ blur(16px) */
      transform: scale(1.06);
      z-index:-3; pointer-events:none;
    }
    /* –í–∏–Ω—å–µ—Ç–∫–∞ –ø–æ –∫—Ä–∞—è–º, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–Ω—Ç —á–∏—Ç–∞–ª—Å—è */
    body.ambient-bg::after{
      content:"";
      position:fixed; inset:0;
      background:
        radial-gradient(120% 100% at 50% 0%, transparent 60%, var(--vignette)),
        linear-gradient(180deg, rgba(255,255,255,var(--veil-top)), rgba(255,255,255,var(--veil-bot)));
      z-index:-2; pointer-events:none;
    }

    /* –°—Ç–µ–∫–ª—è–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî –µ—â—ë –ø—Ä–æ–∑—Ä–∞—á–Ω–µ–µ + blur –ø–æ–º–µ–Ω—å—à–µ */
    .glass-container{
      background: var(--glass-bg);
      -webkit-backdrop-filter: blur(var(--glass-blur));
      backdrop-filter: blur(var(--glass-blur));
      min-height: 100vh;
    }

    /* –§–æ–ª–±—ç–∫, –µ—Å–ª–∏ backdrop-filter –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è */
    @supports not ((backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px))) {
      .glass-container{
        background: rgba(255,255,255,0.70); /* —á—É—Ç—å –ø–ª–æ—Ç–Ω–µ–µ –±–µ–∑ blur */
      }
    }

    .navbar-brand img { height: 60px; }
    .dropdown-menu { backdrop-filter: blur(8px); }

    .flash-message{
      background: linear-gradient(90deg, #34be67 60%, #78e08f 100%);
      color:#fff; padding:1rem 1.5rem; margin:1rem auto; border-radius:.75rem;
      box-shadow:0 2px 16px rgba(52,190,103,0.25);
      font-size:1.2rem; max-width:95%; border:2px solid #22a35d;
    }

    .nav-btn{
      padding:.5rem 1rem; border-radius:.5rem;
      transition: background .2s ease, transform .15s ease;
    }
    .nav-btn:hover{ background-color: rgba(255,255,255,0.1); transform: translateY(-2px); }
    .navbar .btn-hover{ transition: none !important; }

    /* –ß—É—Ç—å –ø–ª–æ—Ç–Ω–µ–µ —Ñ–æ–Ω –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ */
    @media (max-width: 576px){
      :root{
        --glass-bg: rgba(255,255,255,0.60);
        --veil-top: .28; --veil-bot: .38;
      }
    }
  </style>
</head>
<body class="ambient-bg" {% if page_bg %}style="--page-bg: url('{{ page_bg }}');"{% endif %}>
  <div class="glass-container d-flex flex-column">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-lg">
      <div class="container-fluid px-3">
        <a class="navbar-brand" href="{% url 'collection_cards' %}">
          <img src="{% static 'img/logo.png' %}" alt="Bal Carpet" />
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarMenu">
          <ul class="navbar-nav ms-auto align-items-center gap-2">
            <li class="nav-item">
              <a class="nav-link nav-btn btn-outline-light btn-lg" href="{% url 'collection_cards' %}">–ö–∞—Ç–∞–ª–æ–≥</a>
            </li>

            {% if user.is_authenticated %}
            <li class="nav-item">
              <a class="nav-link nav-btn btn-success btn-lg" href="{% url 'batch_list' %}">üöö –õ–æ–≥–∏—Å—Ç–∏–∫–∞</a>
            </li>
            <li class="nav-item">
              <a class="nav-link nav-btn btn-outline-light btn-lg" href="{% url 'collection_list' %}">üõ† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏</a>
            </li>
            {% endif %}

            {% if user.is_authenticated %}
            <li class="nav-item">
              <form method="post" action="{% url 'logout' %}">{% csrf_token %}
                <button class="nav-btn btn btn-outline-light btn-lg" type="submit">–í—ã–π—Ç–∏</button>
              </form>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="nav-link nav-btn btn-outline-light btn-lg" href="{% url 'login' %}">–í–æ–π—Ç–∏</a>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    {% if messages %}
      <div class="container-fluid px-3">
        {% for message in messages %}
          <div class="flash-message {{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <main class="flex-grow-1 container-fluid px-3 py-4">
      {% block content %}{% endblock %}
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => document.querySelectorAll('.flash-message').forEach(el => el.remove()), 3000);
    });
  </script>
</body>
</html>
